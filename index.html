<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Host Analytics">
<title>Host Analytics ‚Äî Airbnb Dashboard</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Playfair+Display:wght@600;700;800&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
:root {
  --coral: #FF5A5F; --coral-light: #FF8A8D; --teal: #00A699; --teal-light: #66C3BC;
  --gold: #FFB400; --purple: #914669; --navy: #2D3436;
  --bg: #FAFAF8; --card: #FFFFFF; --text: #1A1A1A; --text-mid: #4A4A4A; --text-light: #8B8B8B;
  --border: #E8E8E4; --border-light: #F0F0EC;
  --font: 'DM Sans', -apple-system, sans-serif;
  --display: 'Playfair Display', Georgia, serif;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: var(--font); background: var(--bg); color: var(--text); -webkit-font-smoothing: antialiased; }

.header { background: var(--card); border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; }
.header-inner { max-width: 1240px; margin: 0 auto; padding: 0 24px; height: 60px; display: flex; align-items: center; justify-content: space-between; }
.logo { display: flex; align-items: center; gap: 10px; }
.logo-icon { width: 34px; height: 34px; border-radius: 9px; background: linear-gradient(135deg, var(--coral), var(--coral-light)); display: flex; align-items: center; justify-content: center; color: #fff; font-weight: 800; font-size: 16px; font-family: var(--display); }
.logo-text { font-family: var(--display); font-size: 19px; font-weight: 700; }
.tabs { display: flex; gap: 2px; }
.tab-btn { padding: 7px 16px; border-radius: 7px; border: none; cursor: pointer; font-family: var(--font); font-size: 13px; font-weight: 600; background: transparent; color: var(--text-light); transition: all 0.2s; }
.tab-btn.active { background: var(--coral); color: #fff; }
.tab-btn:hover:not(.active) { background: var(--border-light); }
.year-filter { display: flex; gap: 4px; align-items: center; flex-wrap: wrap; }
.year-label { font-size: 12px; color: var(--text-light); margin-right: 6px; }
.year-btn { padding: 5px 10px; border-radius: 6px; cursor: pointer; border: 1px solid var(--border); background: transparent; color: var(--text-light); font-size: 12px; font-weight: 600; font-family: var(--font); transition: all 0.15s; }
.year-btn.active { border-color: var(--coral); background: rgba(255,90,95,0.06); color: var(--coral); }

.main { max-width: 1240px; margin: 0 auto; padding: 24px 24px 60px; }

/* CRITICAL FIX: Use offscreen positioning instead of display:none */
.tab-panel { position: absolute; left: -9999px; width: 100%; visibility: hidden; }
.tab-panel.active { position: relative; left: 0; visibility: visible; }
.tabs-container { position: relative; overflow: hidden; }

.kpi-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 14px; margin-bottom: 24px; }
.kpi-card { background: var(--card); border-radius: 14px; padding: 22px 20px; border: 1px solid var(--border); position: relative; overflow: hidden; transition: all 0.25s; }
.kpi-card:hover { box-shadow: 0 6px 24px rgba(0,0,0,0.06); transform: translateY(-1px); }
.kpi-accent { position: absolute; top: -8px; right: -8px; width: 50px; height: 50px; border-radius: 50%; opacity: 0.06; }
.kpi-label { font-size: 11px; color: var(--text-light); letter-spacing: 0.06em; text-transform: uppercase; font-weight: 600; margin-bottom: 5px; }
.kpi-value { font-family: var(--display); font-size: 28px; font-weight: 700; line-height: 1.1; }
.kpi-sub { font-size: 12px; color: var(--text-light); margin-top: 6px; }

.card { background: var(--card); border-radius: 14px; padding: 22px; border: 1px solid var(--border); margin-bottom: 20px; }
.card-title { font-family: var(--display); font-size: 18px; font-weight: 700; margin-bottom: 2px; }
.card-sub { font-size: 13px; color: var(--text-light); margin-bottom: 14px; }

.grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
.grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }

.platform-row { display: flex; align-items: center; gap: 20px; }
.platform-chart { width: 45%; min-width: 160px; }
.platform-details { flex: 1; }
.platform-item { margin-bottom: 12px; padding: 12px 14px; background: var(--bg); border-radius: 10px; }
.platform-name { display: flex; align-items: center; gap: 8px; margin-bottom: 4px; }
.platform-dot { width: 10px; height: 10px; border-radius: 3px; }
.platform-name span { font-size: 14px; font-weight: 600; }
.platform-stats { font-size: 12px; color: var(--text-light); line-height: 1.7; }

.data-table { width: 100%; border-collapse: collapse; font-size: 13px; }
.data-table th { padding: 10px 12px; text-align: left; font-weight: 600; color: var(--text-light); font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em; border-bottom: 2px solid var(--border); }
.data-table td { padding: 10px 12px; border-bottom: 1px solid var(--border-light); }
.data-table tbody tr:hover { background: var(--bg); }
.td-bold { font-weight: 700; }
.td-coral { font-weight: 600; color: var(--coral); }
.td-teal { font-weight: 600; color: var(--teal); }
.td-purple { color: var(--purple); }

.insight-item { display: flex; gap: 12px; padding: 12px 14px; background: var(--bg); border-radius: 10px; margin-bottom: 10px; }
.insight-bar { width: 4px; border-radius: 2px; flex-shrink: 0; }
.insight-label { font-size: 13px; font-weight: 700; margin-bottom: 2px; }
.insight-detail { font-size: 12px; color: var(--text-mid); line-height: 1.5; }

.highlight-icon { font-size: 28px; margin-bottom: 8px; }
.highlight-label { font-size: 11px; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.06em; font-weight: 600; margin-bottom: 4px; }
.highlight-value { font-family: var(--display); font-size: 26px; font-weight: 700; margin-bottom: 8px; }
.highlight-sub { font-size: 13px; color: var(--text-mid); line-height: 1.6; }

.rec-card { padding: 20px; border-radius: 12px; border-left: 3px solid; }
.rec-icon { font-size: 22px; margin-bottom: 8px; }
.rec-title { font-size: 14px; font-weight: 700; margin-bottom: 6px; }
.rec-text { font-size: 13px; color: var(--text-mid); line-height: 1.55; }

.ring-wrap { display: flex; align-items: center; justify-content: center; min-height: 220px; }
.ring-container { text-align: center; }
.ring-svg { width: 140px; height: 140px; }
.ring-label { position: relative; margin-top: -95px; margin-bottom: 48px; font-family: var(--display); font-size: 28px; font-weight: 700; color: var(--teal); }
.ring-sublabel { font-size: 11px; color: var(--text-light); font-family: var(--font); font-weight: 400; }
.ring-stats { font-size: 13px; color: var(--text-mid); margin-top: 8px; }

.listing-banner { background: linear-gradient(135deg, #1a1a1a 0%, #2d3436 100%); border-radius: 14px; padding: 24px; margin-bottom: 20px; display: flex; align-items: center; gap: 20px; color: #fff; }
.listing-badge { background: var(--coral); color: #fff; font-size: 11px; font-weight: 700; padding: 3px 8px; border-radius: 5px; display: inline-block; margin-bottom: 6px; }
.listing-title { font-family: var(--display); font-size: 22px; font-weight: 700; margin-bottom: 4px; }
.listing-details { font-size: 13px; color: rgba(255,255,255,0.7); line-height: 1.6; }
.listing-rating { display: flex; align-items: center; gap: 6px; font-size: 14px; font-weight: 600; margin-top: 8px; }
.listing-stats { display: flex; gap: 28px; margin-left: auto; }
.listing-stat-item { text-align: center; }
.listing-stat-val { font-family: var(--display); font-size: 24px; font-weight: 700; }
.listing-stat-label { font-size: 11px; color: rgba(255,255,255,0.6); text-transform: uppercase; letter-spacing: 0.05em; }

/* Canvas containers - explicit heights for Chart.js */
.ch-300 { position: relative; height: 300px; }
.ch-320 { position: relative; height: 320px; }
.ch-240 { position: relative; height: 240px; }
.ch-220 { position: relative; height: 220px; }
.ch-200 { position: relative; height: 200px; }
.ch-280 { position: relative; height: 280px; }

@media (max-width: 900px) {
  .kpi-grid { grid-template-columns: repeat(3, 1fr); }
  .grid-2, .grid-3 { grid-template-columns: 1fr; }
  .listing-banner { flex-direction: column; align-items: flex-start; }
  .listing-stats { margin-left: 0; margin-top: 16px; }
  .header-inner { flex-wrap: wrap; height: auto; padding: 12px 16px; gap: 10px; }
}
@media (max-width: 600px) {
  .kpi-grid { grid-template-columns: repeat(2, 1fr); }
  .tabs { overflow-x: auto; }
  .tab-btn { padding: 7px 12px; font-size: 12px; white-space: nowrap; }
  .main { padding: 16px 14px 40px; }
  .card { padding: 16px; }
  .kpi-card { padding: 16px 14px; }
  .kpi-value { font-size: 24px; }
  .platform-row { flex-direction: column; }
  .platform-chart { width: 100%; }
  .data-table { font-size: 11px; }
  .data-table th, .data-table td { padding: 8px 6px; }
  .listing-stats { gap: 16px; }
}
@keyframes fadeUp { from { opacity:0; transform:translateY(12px); } to { opacity:1; transform:translateY(0); } }
.anim { animation: fadeUp 0.4s ease both; }
.d1 { animation-delay:.05s } .d2 { animation-delay:.1s } .d3 { animation-delay:.15s } .d4 { animation-delay:.2s } .d5 { animation-delay:.25s }
</style>
</head>
<body>

<header class="header">
  <div class="header-inner">
    <div class="logo">
      <div class="logo-icon">A</div>
      <span class="logo-text">Host Analytics</span>
    </div>
    <div class="tabs" id="tabs">
      <button class="tab-btn active" data-tab="overview">Overview</button>
      <button class="tab-btn" data-tab="revenue">Revenue</button>
      <button class="tab-btn" data-tab="guests">Guests</button>
      <button class="tab-btn" data-tab="insights">Insights</button>
    </div>
    <div class="year-filter" id="yearFilter">
      <span class="year-label">Year:</span>
      <button class="year-btn active" data-year="all">All</button>
      <button class="year-btn" data-year="2021">2021</button>
      <button class="year-btn" data-year="2022">2022</button>
      <button class="year-btn" data-year="2023">2023</button>
      <button class="year-btn" data-year="2024">2024</button>
      <button class="year-btn" data-year="2025">2025</button>
      <button class="year-btn" data-year="2026">2026</button>
    </div>
  </div>
</header>

<main class="main">
  <div class="listing-banner anim">
    <div>
      <span class="listing-badge">‚òÖ SUPERHOST ¬∑ GUEST FAVORITE</span>
      <div class="listing-title">Historic Adobe in Barrio Viejo</div>
      <div class="listing-details">Tucson, AZ ¬∑ 3 bed ¬∑ 3 bath ¬∑ Sleeps 7 ¬∑ 2,100 sq ft</div>
      <div class="listing-rating"><span style="color:var(--gold)">‚òÖ</span> 4.95 ¬∑ 43 reviews ¬∑ 5 years hosting</div>
    </div>
    <div class="listing-stats">
      <div class="listing-stat-item"><div class="listing-stat-val">192</div><div class="listing-stat-label">Bookings</div></div>
      <div class="listing-stat-item"><div class="listing-stat-val">863</div><div class="listing-stat-label">Nights</div></div>
      <div class="listing-stat-item"><div class="listing-stat-val">$206K</div><div class="listing-stat-label">Earned</div></div>
    </div>
  </div>

  <div class="tabs-container">

    <!-- OVERVIEW -->
    <div class="tab-panel active" id="tab-overview">
      <div class="kpi-grid" id="kpiGrid"></div>
      <div class="card">
        <div class="card-title" id="revTitle">Revenue by Year</div>
        <div class="card-sub" id="revSub">Yearly payout totals</div>
        <div class="ch-300"><canvas id="chartRevenue"></canvas></div>
      </div>
      <div class="grid-2">
        <div class="card">
          <div class="card-title">Platform Split</div>
          <div class="card-sub">Airbnb vs VRBO breakdown</div>
          <div class="platform-row">
            <div class="platform-chart"><div class="ch-200"><canvas id="chartPlatform"></canvas></div></div>
            <div class="platform-details">
              <div class="platform-item"><div class="platform-name"><div class="platform-dot" style="background:var(--coral)"></div><span>Airbnb</span></div><div class="platform-stats">173 bookings ¬∑ $174.4K payout<br>748 nights ¬∑ $252/night avg</div></div>
              <div class="platform-item"><div class="platform-name"><div class="platform-dot" style="background:var(--teal)"></div><span>VRBO</span></div><div class="platform-stats">19 bookings ¬∑ $32.0K payout<br>115 nights ¬∑ $374/night avg</div></div>
            </div>
          </div>
        </div>
        <div class="card">
          <div class="card-title">Day of Week Pricing</div>
          <div class="card-sub">Average nightly rate by check-in day</div>
          <div class="ch-220"><canvas id="chartDow"></canvas></div>
        </div>
      </div>
    </div>

    <!-- REVENUE -->
    <div class="tab-panel" id="tab-revenue">
      <div class="card">
        <div class="card-title">Annual Financial Summary</div>
        <div class="card-sub">Payout, gross payment, and commissions paid by year</div>
        <div class="ch-320"><canvas id="chartFinancial"></canvas></div>
      </div>
      <div class="grid-2">
        <div class="card">
          <div class="card-title">Nightly Rate Trend</div>
          <div class="card-sub">Net payout per night by year</div>
          <div class="ch-240"><canvas id="chartNightly"></canvas></div>
        </div>
        <div class="card">
          <div class="card-title">Occupancy Volume</div>
          <div class="card-sub">Total guest nights booked per year</div>
          <div class="ch-240"><canvas id="chartNights"></canvas></div>
        </div>
      </div>
      <div class="card">
        <div class="card-title">Year-over-Year Details</div>
        <div class="card-sub">All key financial metrics by year</div>
        <div style="overflow-x:auto">
          <table class="data-table"><thead><tr>
            <th>Year</th><th>Gross</th><th>Payout</th><th>Commission</th><th>Bookings</th><th>Nights</th><th>Guests</th><th>Avg/Night</th><th>Avg Stay</th>
          </tr></thead><tbody id="yearTable"></tbody></table>
        </div>
      </div>
    </div>

    <!-- GUESTS -->
    <div class="tab-panel" id="tab-guests">
      <div class="grid-2">
        <div class="card">
          <div class="card-title">Top Guest States</div>
          <div class="card-sub">Where your guests come from</div>
          <div class="ch-280"><canvas id="chartStates"></canvas></div>
        </div>
        <div class="card">
          <div class="card-title">Top Guest Cities</div>
          <div class="card-sub">Most frequent guest origin cities</div>
          <div class="ch-280"><canvas id="chartCities"></canvas></div>
        </div>
      </div>
      <div class="grid-2">
        <div class="card">
          <div class="card-title">Guest Volume Trend</div>
          <div class="card-sub">Total guests hosted per year</div>
          <div class="ch-240"><canvas id="chartGuestTrend"></canvas></div>
        </div>
        <div class="card">
          <div class="card-title">Repeat Guest Insight</div>
          <div class="card-sub">8 of 183 unique guests returned (4.4%)</div>
          <div class="ring-wrap"><div class="ring-container">
            <svg class="ring-svg" viewBox="0 0 36 36">
              <circle cx="18" cy="18" r="15.9" fill="none" stroke="#F0F0EC" stroke-width="2.5"/>
              <circle cx="18" cy="18" r="15.9" fill="none" stroke="#00A699" stroke-width="2.5" stroke-dasharray="4.4 95.6" stroke-linecap="round" transform="rotate(-90 18 18)"/>
            </svg>
            <div class="ring-label">4.4%<div class="ring-sublabel">repeat</div></div>
            <div class="ring-stats"><strong>183</strong> unique guests ¬∑ <strong>8</strong> returned</div>
          </div></div>
        </div>
      </div>
    </div>

    <!-- INSIGHTS -->
    <div class="tab-panel" id="tab-insights">
      <div class="grid-3" style="margin-bottom:20px">
        <div class="card"><div class="highlight-icon">üèÜ</div><div class="highlight-label">Best Year</div><div class="highlight-value" style="color:var(--gold)">2024</div><div class="highlight-sub">$41.9K payout from 53 bookings ‚Äî your highest volume year with strong month-over-month consistency.</div></div>
        <div class="card"><div class="highlight-icon">üìà</div><div class="highlight-label">Highest Nightly Rate</div><div class="highlight-value" style="color:var(--teal)">$376/night</div><div class="highlight-sub">2022 and 2026 achieved the highest avg nightly rates. Shorter stays tend to command premium pricing.</div></div>
        <div class="card"><div class="highlight-icon">üåµ</div><div class="highlight-label">Top Market</div><div class="highlight-value" style="color:var(--coral)">Arizona</div><div class="highlight-sub">38 bookings from AZ guests (20% of all bookings). Phoenix alone accounts for 13 bookings.</div></div>
      </div>
      <div class="grid-2">
        <div class="card">
          <div class="card-title">Performance Highlights</div>
          <div class="card-sub">Key observations from your booking data</div>
          <div class="insight-item"><div class="insight-bar" style="background:var(--coral)"></div><div><div class="insight-label">Platform Mix</div><div class="insight-detail">90% Airbnb, 10% VRBO ‚Äî but VRBO commands $374/night vs Airbnb's $252/night.</div></div></div>
          <div class="insight-item"><div class="insight-bar" style="background:var(--teal)"></div><div><div class="insight-label">Seasonality</div><div class="insight-detail">Peak months are typically Feb-Apr and Oct-Dec. Summer (Jun-Aug) consistently shows lower occupancy.</div></div></div>
          <div class="insight-item"><div class="insight-bar" style="background:var(--gold)"></div><div><div class="insight-label">Stay Length</div><div class="insight-detail">Average stay decreased from 7.8 nights (2021) to ~3-4 nights (2024-2026), suggesting a shift toward short-stay guests.</div></div></div>
          <div class="insight-item"><div class="insight-bar" style="background:var(--purple)"></div><div><div class="insight-label">2024 Growth</div><div class="insight-detail">54.5% YoY revenue jump in 2024 ‚Äî driven by doubling bookings to 53 with 225 total nights.</div></div></div>
          <div class="insight-item"><div class="insight-bar" style="background:#3D5A80"></div><div><div class="insight-label">Repeat Guests</div><div class="insight-detail">Only 4.4% repeat rate. Opportunity to build loyalty through follow-up messages or returning guest discounts.</div></div></div>
        </div>
        <div class="card">
          <div class="card-title">Year-over-Year Comparison</div>
          <div class="card-sub">Revenue and volume progression</div>
          <div class="ch-300"><canvas id="chartYoy"></canvas></div>
        </div>
      </div>
      <div class="card">
        <div class="card-title">Recommendations</div>
        <div class="card-sub">Data-driven suggestions to grow your rental income</div>
        <div class="grid-3">
          <div class="rec-card" style="background:rgba(255,180,0,0.06);border-color:var(--gold)"><div class="rec-icon">‚ö°</div><div class="rec-title">Boost Summer Occupancy</div><div class="rec-text">Jun-Aug is your slowest period. Consider lowering rates 15-20% or offering weekly discounts to fill gaps.</div></div>
          <div class="rec-card" style="background:rgba(0,166,153,0.06);border-color:var(--teal)"><div class="rec-icon">üîÑ</div><div class="rec-title">Increase Repeat Rate</div><div class="rec-text">At 4.4%, there's huge upside. Send post-stay thank-you messages with a 10% return-guest discount code.</div></div>
          <div class="rec-card" style="background:rgba(145,70,105,0.06);border-color:var(--purple)"><div class="rec-icon">üìä</div><div class="rec-title">Grow VRBO Presence</div><div class="rec-text">VRBO averages $374/night vs $252 on Airbnb. Invest in VRBO listing optimization to capture more high-value bookings.</div></div>
        </div>
      </div>
    </div>

  </div>
</main>

<script>
// ===== DATA =====
const MD = [
  {y:2021,m:1,p:2351.18,n:16,g:5,b:2},{y:2021,m:2,p:4006.45,n:31,g:3,b:1},{y:2021,m:3,p:4969.11,n:29,g:14,b:3},
  {y:2021,m:4,p:7485.69,n:25,g:16,b:5},{y:2021,m:5,p:2693.30,n:12,g:15,b:3},{y:2021,m:6,p:933.79,n:4,g:6,b:1},
  {y:2021,m:7,p:280.01,n:2,g:3,b:1},{y:2021,m:10,p:15757.94,n:80,g:19,b:5},{y:2021,m:11,p:1892.48,n:7,g:16,b:4},
  {y:2021,m:12,p:3905.92,n:13,g:12,b:3},
  {y:2022,m:1,p:4813.02,n:16,g:12,b:3},{y:2022,m:2,p:10318.80,n:26,g:20,b:5},{y:2022,m:3,p:8884.61,n:24,g:35,b:7},
  {y:2022,m:4,p:5252.57,n:14,g:19,b:5},{y:2022,m:5,p:2646.64,n:7,g:5,b:2},{y:2022,m:10,p:823.28,n:2,g:2,b:1},
  {y:2023,m:1,p:1192.66,n:6,g:3,b:2},{y:2023,m:2,p:3594.66,n:11,g:12,b:3},{y:2023,m:3,p:4703.50,n:13,g:12,b:4},
  {y:2023,m:4,p:3335.02,n:9,g:19,b:3},{y:2023,m:5,p:672.93,n:2,g:6,b:1},{y:2023,m:6,p:1479.00,n:4,g:1,b:1},
  {y:2023,m:7,p:419.37,n:5,g:3,b:2},{y:2023,m:8,p:1290.17,n:12,g:18,b:2},{y:2023,m:9,p:2677.71,n:31,g:9,b:2},
  {y:2023,m:10,p:2079.38,n:17,g:16,b:4},{y:2023,m:11,p:2954.07,n:15,g:24,b:5},{y:2023,m:12,p:2745.60,n:24,g:16,b:4},
  {y:2024,m:1,p:5724.53,n:29,g:37,b:8},{y:2024,m:2,p:4895.06,n:19,g:15,b:5},{y:2024,m:3,p:4739.40,n:24,g:19,b:7},
  {y:2024,m:4,p:5024.18,n:27,g:15,b:6},{y:2024,m:5,p:2754.25,n:22,g:21,b:5},{y:2024,m:6,p:1142.40,n:13,g:16,b:3},
  {y:2024,m:7,p:1904.48,n:16,g:7,b:3},{y:2024,m:8,p:1568.25,n:15,g:13,b:3},{y:2024,m:9,p:3350.12,n:20,g:5,b:3},
  {y:2024,m:10,p:2117.25,n:12,g:20,b:4},{y:2024,m:11,p:2377.69,n:10,g:19,b:3},{y:2024,m:12,p:6327.51,n:18,g:20,b:3},
  {y:2025,m:1,p:2008.67,n:7,g:6,b:2},{y:2025,m:2,p:7209.24,n:20,g:27,b:6},{y:2025,m:3,p:6323.60,n:21,g:41,b:8},
  {y:2025,m:4,p:3504.67,n:14,g:23,b:5},{y:2025,m:5,p:3320.08,n:9,g:8,b:3},{y:2025,m:8,p:579.09,n:3,g:5,b:1},
  {y:2025,m:9,p:2535.07,n:11,g:9,b:3},{y:2025,m:10,p:718.97,n:2,g:6,b:1},{y:2025,m:11,p:5662.36,n:15,g:22,b:5},
  {y:2025,m:12,p:3514.50,n:11,g:9,b:3},
  {y:2026,m:1,p:3427.23,n:10,g:6,b:2},{y:2026,m:2,p:10447.44,n:24,g:30,b:6},{y:2026,m:3,p:6589.31,n:19,g:18,b:5},
  {y:2026,m:4,p:1508.45,n:5,g:10,b:2},{y:2026,m:5,p:905.88,n:3,g:4,b:1},{y:2026,m:7,p:602.57,n:2,g:8,b:1},
  {y:2026,m:8,p:1513.10,n:5,g:4,b:1},
];
const YD = [
  {year:2021,payout:44275.87,payment:62462.84,nights:219,guests:109,bookings:28,avgNight:248.36,commission:2240.90},
  {year:2022,payout:32738.92,payment:47945.31,nights:89,guests:93,bookings:23,avgNight:376.37,commission:1302.07},
  {year:2023,payout:27144.07,payment:42697.38,nights:149,guests:139,bookings:33,avgNight:200.79,commission:4975.29},
  {year:2024,payout:41925.12,payment:64297.07,nights:225,guests:207,bookings:53,avgNight:192.56,commission:8775.41},
  {year:2025,payout:35376.25,payment:54558.59,nights:113,guests:156,bookings:37,avgNight:311.43,commission:1339.83},
  {year:2026,payout:24993.98,payment:35997.14,nights:68,guests:80,bookings:18,avgNight:376.15,commission:846.42},
];
const MO = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
const CL = {coral:'#FF5A5F',teal:'#00A699',gold:'#FFB400',purple:'#914669'};
const CC = ['#FF5A5F','#00A699','#FFB400','#914669','#3D5A80','#EE6C4D'];

// ===== STATE =====
let selYear = 'all';
let charts = {};

// ===== CHART DEFAULTS =====
Chart.defaults.font.family = "'DM Sans', sans-serif";
Chart.defaults.font.size = 12;
Chart.defaults.color = '#8B8B8B';
Chart.defaults.plugins.legend.display = false;

// ===== HELPERS =====
function fmt(n) { return n >= 1000 ? '$'+(n/1000).toFixed(0)+'k' : '$'+n; }
function fmtF(n) { return '$'+n.toLocaleString(undefined,{maximumFractionDigits:0}); }
function totals(yr) {
  const d = yr==='all' ? YD : YD.filter(y=>y.year==yr);
  const p=d.reduce((s,r)=>s+r.payout,0), pay=d.reduce((s,r)=>s+r.payment,0),
        n=d.reduce((s,r)=>s+r.nights,0), g=d.reduce((s,r)=>s+r.guests,0), b=d.reduce((s,r)=>s+r.bookings,0);
  return {p,pay,n,g,b,an:p/Math.max(n,1),as:n/Math.max(b,1)};
}
function chartData(yr) {
  if(yr==='all') return YD.map(y=>({l:String(y.year),p:y.payout,b:y.bookings}));
  return MO.map((m,i)=>{const d=MD.find(r=>r.y==yr&&r.m===i+1);return{l:m,p:d?d.p:0,b:d?d.b:0};});
}
function mk(id) { return document.getElementById(id); }
function nuke(key) { if(charts[key]){charts[key].destroy();charts[key]=null;} }

// ===== KPIs =====
function renderKPIs() {
  const t = totals(selYear);
  mk('kpiGrid').innerHTML = [
    {l:'Total Payout',v:'$'+(t.p/1000).toFixed(1)+'K',s:'of $'+(t.pay/1000).toFixed(0)+'K gross',c:CL.coral},
    {l:'Bookings',v:t.b,s:t.g+' total guests',c:CL.teal},
    {l:'Nights Booked',v:t.n,s:t.as.toFixed(1)+' avg stay',c:CL.gold},
    {l:'Avg / Night',v:'$'+t.an.toFixed(0),s:'net payout rate',c:CL.purple},
    {l:'Guests / Booking',v:(t.g/Math.max(t.b,1)).toFixed(1),s:'avg group size',c:'#3D5A80'},
  ].map((k,i)=>`<div class="kpi-card anim d${i+1}"><div class="kpi-accent" style="background:${k.c}"></div><div class="kpi-label">${k.l}</div><div class="kpi-value">${k.v}</div><div class="kpi-sub">${k.s}</div></div>`).join('');
}

// ===== CHART RENDERS =====
function renderRevenue() {
  const d=chartData(selYear);
  mk('revTitle').textContent = selYear==='all'?'Revenue by Year':selYear+' Revenue';
  mk('revSub').textContent = selYear==='all'?'Yearly payout totals':'Monthly breakdown for '+selYear;
  nuke('rev');
  charts.rev = new Chart(mk('chartRevenue'),{
    type:'bar',
    data:{labels:d.map(x=>x.l),datasets:[
      {label:'Payout',data:d.map(x=>x.p),type:'line',borderColor:CL.coral,backgroundColor:'rgba(255,90,95,0.08)',borderWidth:2.5,fill:true,tension:0.3,pointRadius:4,pointBackgroundColor:CL.coral,pointBorderColor:'#fff',pointBorderWidth:2,yAxisID:'y'},
      {label:'Bookings',data:d.map(x=>x.b),backgroundColor:'rgba(0,166,153,0.6)',borderRadius:6,barPercentage:0.5,yAxisID:'y1'}
    ]},
    options:{responsive:true,maintainAspectRatio:false,
      plugins:{legend:{display:true,position:'top',labels:{usePointStyle:true,padding:16,font:{size:12}}}},
      scales:{y:{position:'left',grid:{color:'#F0F0EC'},ticks:{callback:v=>fmt(v)}},y1:{position:'right',grid:{display:false},ticks:{stepSize:1}}}
    }
  });
}

function renderPlatform() {
  nuke('plat');
  charts.plat = new Chart(mk('chartPlatform'),{
    type:'doughnut',
    data:{labels:['Airbnb','VRBO'],datasets:[{data:[173,19],backgroundColor:[CL.coral,CL.teal],borderWidth:0,spacing:4}]},
    options:{responsive:true,maintainAspectRatio:false,cutout:'62%'}
  });
}

function renderDow() {
  nuke('dow');
  charts.dow = new Chart(mk('chartDow'),{
    type:'bar',
    data:{labels:['Mon','Tue','Wed','Thu','Fri','Sat','Sun'],datasets:[{label:'Avg/Night',data:[196,252,229,317,282,248,271],backgroundColor:CL.gold,borderRadius:6,barPercentage:0.55}]},
    options:{responsive:true,maintainAspectRatio:false,scales:{y:{grid:{color:'#F0F0EC'},ticks:{callback:v=>'$'+v}},x:{grid:{display:false}}}}
  });
}

function renderFinancial() {
  nuke('fin');
  charts.fin = new Chart(mk('chartFinancial'),{
    type:'bar',
    data:{labels:YD.map(y=>y.year),datasets:[
      {label:'Gross Payment',data:YD.map(y=>y.payment),backgroundColor:'#E8E8E4',borderRadius:6,barPercentage:0.6},
      {label:'Net Payout',data:YD.map(y=>y.payout),backgroundColor:CL.coral,borderRadius:6,barPercentage:0.6},
      {label:'Commission',data:YD.map(y=>y.commission),backgroundColor:CL.purple,borderRadius:6,barPercentage:0.6},
    ]},
    options:{responsive:true,maintainAspectRatio:false,
      plugins:{legend:{display:true,position:'top',labels:{usePointStyle:true,padding:16,font:{size:12}}}},
      scales:{y:{grid:{color:'#F0F0EC'},ticks:{callback:v=>fmt(v)}},x:{grid:{display:false}}}
    }
  });
}

function renderNightly() {
  nuke('nightly');
  charts.nightly = new Chart(mk('chartNightly'),{
    type:'line',
    data:{labels:YD.map(y=>y.year),datasets:[{label:'Avg/Night',data:YD.map(y=>y.avgNight),borderColor:CL.teal,backgroundColor:'rgba(0,166,153,0.08)',borderWidth:2.5,fill:true,tension:0.3,pointRadius:5,pointBackgroundColor:CL.teal,pointBorderColor:'#fff',pointBorderWidth:2}]},
    options:{responsive:true,maintainAspectRatio:false,scales:{y:{grid:{color:'#F0F0EC'},ticks:{callback:v=>'$'+v}},x:{grid:{display:false}}}}
  });
}

function renderNights() {
  nuke('nights');
  charts.nights = new Chart(mk('chartNights'),{
    type:'bar',
    data:{labels:YD.map(y=>y.year),datasets:[{label:'Nights',data:YD.map(y=>y.nights),backgroundColor:CC,borderRadius:6,barPercentage:0.55}]},
    options:{responsive:true,maintainAspectRatio:false,scales:{y:{grid:{color:'#F0F0EC'}},x:{grid:{display:false}}}}
  });
}

function renderTable() {
  mk('yearTable').innerHTML = YD.map(y=>`<tr><td class="td-bold">${y.year}</td><td>${fmtF(y.payment)}</td><td class="td-coral">${fmtF(y.payout)}</td><td class="td-purple">${fmtF(y.commission)}</td><td>${y.bookings}</td><td>${y.nights}</td><td>${y.guests}</td><td class="td-teal">$${y.avgNight.toFixed(0)}</td><td>${(y.nights/y.bookings).toFixed(1)} nights</td></tr>`).join('');
}

function renderStates() {
  nuke('states');
  charts.states = new Chart(mk('chartStates'),{
    type:'bar',
    data:{labels:['AZ','CA','NY','CO','WA','TX','FL','NC','MT','MA'],datasets:[{label:'Bookings',data:[38,18,12,10,10,5,4,3,3,3],backgroundColor:[38,18,12,10,10,5,4,3,3,3].map((_,i)=>`rgba(255,90,95,${1-i*0.08})`),borderRadius:6,barPercentage:0.55}]},
    options:{responsive:true,maintainAspectRatio:false,indexAxis:'y',scales:{x:{grid:{color:'#F0F0EC'}},y:{grid:{display:false}}}}
  });
}

function renderCities() {
  nuke('cities');
  charts.cities = new Chart(mk('chartCities'),{
    type:'bar',
    data:{labels:['Phoenix','Tucson','New York','Seattle','San Diego','Los Angeles','Flagstaff','Dallas','Las Vegas'],datasets:[{label:'Bookings',data:[13,9,8,8,5,4,4,3,3],backgroundColor:[13,9,8,8,5,4,4,3,3].map((_,i)=>`rgba(0,166,153,${1-i*0.08})`),borderRadius:6,barPercentage:0.55}]},
    options:{responsive:true,maintainAspectRatio:false,indexAxis:'y',scales:{x:{grid:{color:'#F0F0EC'}},y:{grid:{display:false}}}}
  });
}

function renderGuestTrend() {
  nuke('gtrend');
  charts.gtrend = new Chart(mk('chartGuestTrend'),{
    type:'line',
    data:{labels:YD.map(y=>y.year),datasets:[{label:'Guests',data:YD.map(y=>y.guests),borderColor:CL.purple,backgroundColor:'rgba(145,70,105,0.08)',borderWidth:2.5,fill:true,tension:0.3,pointRadius:5,pointBackgroundColor:CL.purple,pointBorderColor:'#fff',pointBorderWidth:2}]},
    options:{responsive:true,maintainAspectRatio:false,scales:{y:{grid:{color:'#F0F0EC'}},x:{grid:{display:false}}}}
  });
}

function renderYoy() {
  nuke('yoy');
  charts.yoy = new Chart(mk('chartYoy'),{
    type:'bar',
    data:{labels:YD.map(y=>y.year),datasets:[
      {label:'Payout',data:YD.map(y=>y.payout),backgroundColor:'rgba(255,90,95,0.8)',borderRadius:6,barPercentage:0.45,yAxisID:'y'},
      {label:'Bookings',data:YD.map(y=>y.bookings),type:'line',borderColor:CL.teal,borderWidth:2.5,pointRadius:5,pointBackgroundColor:CL.teal,pointBorderColor:'#fff',pointBorderWidth:2,yAxisID:'y1'},
    ]},
    options:{responsive:true,maintainAspectRatio:false,
      plugins:{legend:{display:true,position:'top',labels:{usePointStyle:true,padding:16,font:{size:12}}}},
      scales:{y:{position:'left',grid:{color:'#F0F0EC'},ticks:{callback:v=>fmt(v)}},y1:{position:'right',grid:{display:false}}}
    }
  });
}

// ===== INITIALIZATION: Render ALL charts while all panels are visible =====
function initAll() {
  // Temporarily show all panels so Chart.js can measure them
  document.querySelectorAll('.tab-panel').forEach(p => {
    p.style.position = 'relative';
    p.style.left = '0';
    p.style.visibility = 'visible';
  });

  renderKPIs();
  renderRevenue();
  renderPlatform();
  renderDow();
  renderFinancial();
  renderNightly();
  renderNights();
  renderTable();
  renderStates();
  renderCities();
  renderGuestTrend();
  renderYoy();

  // Now hide all panels except the active one
  document.querySelectorAll('.tab-panel').forEach(p => {
    if (!p.classList.contains('active')) {
      p.style.position = '';
      p.style.left = '';
      p.style.visibility = '';
    }
  });
}

// Run after page is fully loaded
window.addEventListener('load', initAll);

// ===== TAB NAV =====
mk('tabs').addEventListener('click', e => {
  if (!e.target.classList.contains('tab-btn')) return;
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  e.target.classList.add('active');
  const tab = e.target.dataset.tab;
  document.querySelectorAll('.tab-panel').forEach(p => {
    p.classList.remove('active');
    p.style.position = '';
    p.style.left = '';
    p.style.visibility = '';
  });
  const panel = mk('tab-' + tab);
  panel.classList.add('active');
  panel.style.position = 'relative';
  panel.style.left = '0';
  panel.style.visibility = 'visible';
});

// ===== YEAR FILTER =====
mk('yearFilter').addEventListener('click', e => {
  if (!e.target.classList.contains('year-btn')) return;
  document.querySelectorAll('.year-btn').forEach(b => b.classList.remove('active'));
  e.target.classList.add('active');
  selYear = e.target.dataset.year;
  renderKPIs();
  renderRevenue();
});
</script>
</body>
</html>